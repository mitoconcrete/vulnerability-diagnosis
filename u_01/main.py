from u_01.module import get_permit_root_login_result, diagnosis
from common.module import check_ssh, has_file
from common.connect import SSHClientContextManager

def main(config):
    with SSHClientContextManager(**config) as client:
        if not check_ssh(client):
            raise Exception("ssh process is not exist")
        
        if not has_file(client, "/etc/ssh/sshd_config"):
            raise Exception("sshd_config file is not exist")
        
        success_criteria = "PermitRootLogin no"
        result = get_permit_root_login_result(client, success_criteria)
        if diagnosis(result):
            print("PermitRootLogin is restricted.")
        else:
            print("PermitRootLogin is not restricted.")