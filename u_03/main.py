from u_03.enum import FILEPATH
from u_03.module import diagnosis
from common.module import show_result, validate
from common.connect import SSHClientContextManager

def main(config, os="Linux", version=0):
    with SSHClientContextManager(**config) as client:
        config_filepaths = FILEPATH[os.upper()].value
        
        if not all([validate(client, filepath) for filepath in config_filepaths]):
            raise Exception("some file is not exist")
            
        abnormality, details = diagnosis(client, os, version)   
        show_result(abnormality, details)