import paramiko

class SSHClientContextManager:
    def __init__(self, hostname, port, username, password=None, key_filename=None):
        self.hostname = hostname
        self.port = port
        self.username = username
        self.password = password
        self.key_filename = key_filename
        self.client = None

    def __enter__(self):
        # SSH 클라이언트 객체 생성
        self.client = paramiko.SSHClient()
        
        # 자동으로 호스트 키를 추가하도록 설정
        self.client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        
        # 서버에 연결
        self.client.connect(
            self.hostname,
            port=self.port,
            username=self.username,
            password=self.password,
            key_filename=self.key_filename
        )
       
        # 클라이언트를 반환
        return self.client

    def __exit__(self, exc_type, exc_val, exc_tb):
        if self.client:
            self.client.close()
