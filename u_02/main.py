from u_02.enum import PASSWORD_FILEPATH
from u_02.module import diagnosis, show_result, validate
from common.connect import SSHClientContextManager

def main(config, os="Linux"):
    try:
        with SSHClientContextManager(**config) as client:
            password_filepath = PASSWORD_FILEPATH[os.upper()].value
            if not validate(client, password_filepath):
                raise Exception("password file is not exist")
            
            abnormality, details = diagnosis(client, os, password_filepath)
            
            show_result(abnormality, details)

    except Exception as e:
        print(e)