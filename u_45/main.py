from u_45.enum import FILEPATH
from u_45.module import diagnosis, show_result, validate
from common.connect import SSHClientContextManager

def main(config, os="Linux"):
    with SSHClientContextManager(**config) as client:
        config_file_paths = FILEPATH[os.upper()].value
        
        if not all([validate(client, file_path) for file_path in config_file_paths]):
            raise Exception("some file is not exist")
        
        abnormality, details = diagnosis(client, os)
            
        show_result(abnormality, details)