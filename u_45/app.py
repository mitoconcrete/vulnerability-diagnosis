from u_45.enum import FILEPATH
from u_45.module import diagnosis
from common.module import show_result, validate
from common.connect import SSHClientContextManager

def app(config, os="LINUX", version=-1):
    with SSHClientContextManager(**config) as client:
        config_filepaths = FILEPATH[os].value
        
        if not all([validate(client, filepath) for filepath in config_filepaths]):
            raise Exception("config file is not exist")
        
        final_result, details = diagnosis(client, os, version)
        
        show_result(final_result, details)